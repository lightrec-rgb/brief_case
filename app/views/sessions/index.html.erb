<h1 class="text-2xl font-semibold mb-4">Learn</h1>

<div class="mb-4 flex gap-2">
  <%= link_to "Start new session", new_session_path, class: "bg-brand-blue text-white px-3 py-2 rounded hover:bg-gold" %>
</div>

<% if @sessions.blank? %>
  <p class="text-gray-600">No sessions yet. Start one now.</p>
<% else %>
  <table class="w-full text-sm">
    <thead>
      <tr class="border-b">
        <th class="py-2 pr-2">Name</th>
        <th class="py-2 pr-2">Subject</th>
        <th class="py-2 pr-2">Due now</th>
        <th class="px-2 py-2">Cards</th>
        <th class="py-2 pr-2">Status</th>
        <th class="py-2 pr-2">Updated</th>
        <th class="py-2 pr-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @sessions.each do |s| %>
        <tr class="border-b">
          <td class="py-2 pr-2"><%= s.name.presence || "Session ##{s.id}" %></td>
          <td class="py-2 pr-2"><%= s.subject&.name %></td>

          <td class="py-2 pr-2">
            <% new_cards    = s.new_count %>
            <% review_cards = s.review_count %>
            <% due_now      = s.due_count %>

            <div>
              <strong><%= due_now %></strong>/<%= s.total_count %>
            </div>
            <div class="text-xs text-gray-500">
              <%= new_cards %> new · <%= review_cards %> review
            </div>
          </td>

          <td class="px-2 py-2 leading-tight">
            <% new_cards    = s.new_count %>
            <% review_total = s.review_count %>

            <div class="text-sm">
              <span title="Cards never studied">New:</span> <%= new_cards %> ·
              <span title="All review cards, even if not due today">Review:</span> <%= review_total %>
            </div>
          </td>

          <td class="px-2 py-2"><%= session_status_badge(s) %></td>
          <td class="py-2 pr-2 text-gray-500"><%= l(s.updated_at, format: :short) %></td>
          <td class="py-2 pr-2">
            <%= link_to "Open", session_path(s), class: "underline" %> ·
            <%= button_to "Reset",
                  reset_session_path(s),
                  method: :post,
                  form:  { data: { turbo_confirm: "Reset this session? Progress will be cleared." }, class: "inline" },
                  class: "underline bg-transparent p-0 border-0 cursor-pointer align-baseline" %> ·
            <%= button_to "Delete",
                  session_path(s),
                  method: :delete,
                  data: { turbo_confirm: "Delete this session? You’ll lose its progress permanently." },
                  form:  { onsubmit: "return confirm('Delete this session? You’ll lose its progress permanently.')", class: "inline" },
                  class: "underline text-red-600 bg-transparent p-0 border-0 cursor-pointer align-baseline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>