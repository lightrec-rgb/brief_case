<%# Back link uses the computed @return_subject_id, which prefers params → session → entry subject %>
<div class="mb-4">
  <%= link_to "← Back to Cards", entries_path(subject_id: @return_subject_id),
      class: "text-sm underline text-gray-700 hover:text-gray-900" %>
</div>

<% if @entry.kind == "Case" %>
  <% c = @entry.case_detail %>
  <h1 class="text-xl font-semibold mb-2"><%= c&.case_name.presence || "(untitled)" %></h1>
  <p class="text-gray-600 mb-2"><strong>Subject:</strong> <%= @entry.subject&.name %></p>
  <p class="mb-4"><strong>Citation:</strong> <%= c&.full_citation.presence || "—" %></p>

  <div class="grid gap-4">
    <div>
      <h2 class="font-semibold">Material Facts</h2>
      <%= c&.material_facts.present? ? simple_format(c.material_facts) : content_tag(:p, "—", class: "text-gray-500") %>
    </div>
    <div class="mt-8">
      <h2 class="font-semibold">Issue</h2>
      <%= c&.issue.present? ? simple_format(c.issue) : content_tag(:p, "—", class: "text-gray-500") %>
    </div>
    <div class="mt-8">
      <h2 class="font-semibold">Key Principle</h2>
      <%= c&.key_principle.present? ? simple_format(c.key_principle) : content_tag(:p, "—", class: "text-gray-500") %>
    </div>
  </div>

<% elsif @entry.kind == "Provision" %>
  <% s = @entry.provision_detail %>
  <h1 class="text-xl font-semibold mb-2">
    <%= s&.act&.act_name.presence || "(untitled Act)" %>
  </h1>
  <p class="text-gray-600 mb-2"><strong>Subject:</strong> <%= @entry.subject&.name %></p>
  <p class="mb-4"><strong>Provision:</strong> <%= s&.provision_ref.presence || "—" %></p>

  <div class="grid gap-4">
    <div>
      <h2 class="font-semibold">Provision Text</h2>
      <%= s&.provision_text.present? ? simple_format(s.provision_text) : content_tag(:p, "—", class: "text-gray-500") %>
    </div>
  </div>
<% end %>

<p class="mt-6">
  <%= link_to "Edit",
        edit_entry_path(@entry, subject_id: @return_subject_id),
        class: "underline" %>
  ·
  <%= link_to "Back to Cards",
        entries_path(subject_id: @return_subject_id),
        class: "underline" %>
</p>
