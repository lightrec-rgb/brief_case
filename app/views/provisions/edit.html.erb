<h1 class="text-xl font-semibold mb-4">
  Edit Provision — <%= @act.display_name %>
</h1>

<% if @entry.errors.any? || @entry.provision_detail&.errors&.any? %>
  <div class="mb-3 rounded border border-red-300 bg-red-50 p-3 text-sm text-red-800">
    <strong>There were problems with your submission:</strong>
    <ul class="list-disc pl-5">
      <% @entry.errors.full_messages.each { |m| concat content_tag(:li, m) } %>
      <% @entry.provision_detail&.errors&.full_messages&.each { |m| concat content_tag(:li, m) } %>
    </ul>
  </div>
<% end %>

<%= form_with model: @entry, url: act_provision_path(@act, @provision), method: :patch do |f| %>
  <%= hidden_field_tag :subject_id, params[:subject_id] if params[:subject_id].present? %>

  <div class="mb-3 text-sm text-gray-700">
    <strong>Act:</strong>
    <%= [@act.act_short_name.presence || @act.act_name, @act.year, @act.jurisdiction].compact.join(" ") %>
    <span class="mx-2">•</span>
    <%= link_to "Edit Act header", edit_act_path(@act), class: "underline text-sm" %>
  </div>

  <%= f.fields_for :provision_detail do |s| %>
    <%= s.hidden_field :id %>

    <div class="mb-3">
      <%= s.label :provision_ref, "Provision ref" %>
      <%= s.text_field :provision_ref, class: "border p-2 w-full rounded", required: true, autofocus: true %>
    </div>

    <div class="mb-3">
      <%= s.label :summary, "Short title (optional)" %>
      <%= s.text_field :summary, class: "border p-2 w-full rounded", placeholder: "e.g., Causation test" %>
    </div>

    <div class="mb-3">
      <%= s.label :provision_text, "Provision text" %>
      <%= s.text_area :provision_text, rows: 14,
      class: "mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-base leading-6 shadow-sm focus:border-brand-blue focus:ring-2 focus:ring-brand-blue min-h-[14rem] resize-y",
      placeholder: "Paste the provision text here" %>
    </div>
  <% end %>

  <div class="mt-4">
    <%= f.submit "Update provision", class: "px-4 py-2 rounded bg-brand-blue text-white hover:bg-gold" %>
    <%= link_to "Cancel", entries_path(subject_id: params[:subject_id]), class: "ml-2 text-gray-600 hover:underline" %>
  </div>
<% end %>
