<h1 class="text-xl font-semibold mb-4">
  Add Provision to <%= @act.display_name %>
</h1>

<% if @entry.errors.any? || @entry.provision_detail&.errors&.any? %>
  <div class="mb-3 rounded border border-red-300 bg-red-50 p-3 text-sm text-red-800">
    <strong>There were problems with your submission:</strong>
    <ul class="list-disc pl-5">
      <% @entry.errors.full_messages.each { |m| concat content_tag(:li, m) } %>
      <% @entry.provision_detail&.errors&.full_messages&.each { |m| concat content_tag(:li, m) } %>
    </ul>
  </div>
<% end %>

<%= form_with model: @entry, url: act_provisions_path(@act) do |f| %>
  <%= f.hidden_field :kind, value: "Provision" %>
  <%= hidden_field_tag :subject_id, params[:subject_id] if params[:subject_id].present? %>

  <div class="mb-3 text-sm text-gray-700">
    <strong>Act:</strong>
    <%= [@act.act_short_name.presence || @act.act_name, @act.year, @act.jurisdiction].compact.join(" ") %>
  </div>

  <%= f.fields_for :provision_detail do |s| %>
    <div class="mb-3">
      <%= s.label :provision_ref, "Provision ref (e.g., s 48(1)(c))" %>
      <%= s.text_field :provision_ref, class: "border p-2 w-full rounded", required: true, autofocus: true %>
    </div>

    <div class="mb-3">
      <%= s.label :summary, "Short title (optional)" %>
      <%= s.text_field :summary, class: "border p-2 w-full rounded", placeholder: "e.g., Good Samaritan section" %>
    </div>

    <div class="mb-3">
      <%= s.label :provision_text, "Provision text" %>
      <%= s.text_area :provision_text, rows: 10, class: "border p-2 w-full rounded font-mono" %>
      <p class="mt-1 text-xs text-gray-500">Plain text only (rich text editor removed).</p>
    </div>
  <% end %>

  <div class="mt-4">
    <%= f.submit "Save provision", class: "px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700" %>
    <%= link_to "Cancel", entries_path(subject_id: params[:subject_id]), class: "ml-2 text-gray-600 hover:underline" %>
  </div>
<% end %>
