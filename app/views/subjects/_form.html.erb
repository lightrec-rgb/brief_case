<%= form_with model: @subject do |f| %>

  <div>
    <%= f.label :name, "Subject name", class: "block font-medium" %>
    <%= f.text_field :name, required: true, class: "mt-1 border rounded px-2 py-1 w-full" %>
  </div>

  <div class="mt-4">
    <%= f.label :parent_id, "Parent Subject", class: "block font-medium" %><br>

    <%# prevent selecting self or descendants; show hierarchy indentation %>
    <% selectable = current_user.subjects
           .where.not(id: [@subject.id] + (@subject.persisted? ? @subject.descendant_ids : []))
           .order(:name) %>

    <% options = selectable.map { |s|
         indent = "â€” " * s.depth
         ["#{indent}#{s.name}", s.id]
       } %>

    <%= f.select :parent_id,
          options_for_select([["(none)", nil]] + options, @subject.parent_id),
          {},
          class: "border rounded px-2 py-1 w-full mt-1" %>
  </div>

  <div class="mt-6">
    <%= f.submit(@subject.persisted? ? "Update Subject" : "Create Subject",
          class: "bg-brand-blue text-white px-3 py-2 rounded-md text-sm font-medium hover:bg-gold") %>
  </div>
<% end %>