<%# app/views/subjects/_form.html.erb %>
<%# Normalise the variable so the partial works with either @subject or subject local %>
<% subject = local_assigns[:subject] || @subject || current_user.subjects.new %>

<%# Show validation errors if any %>
<% if subject.errors.any? %>
  <div class="mb-3 rounded border border-red-200 bg-red-50 p-3 text-sm text-red-800">
    <strong><%= pluralize(subject.errors.count, "error") %> prevented saving:</strong>
    <ul class="list-disc pl-4">
      <% subject.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with model: subject do |f| %>
  <div>
    <%= f.label :name, "Subject name", class: "block font-medium" %>
    <%= f.text_field :name, required: true, class: "mt-1 border rounded px-2 py-1 w-full" %>
  </div>

  <div class="mt-4">
    <%= f.label :parent_id, "Parent Subject", class: "block font-medium" %><br>

    <%= f.select :parent_id,
          options_for_select(
            [["(none)", nil]] + subject_options_for_select(current_user),
            subject.parent_id
          ),
          {},
          class: "border rounded px-2 py-1 w-full mt-1" %>
  </div>


  <div class="mt-6">
    <%= f.submit(subject.persisted? ? "Update Subject" : "Create Subject",
          class: "bg-brand-blue text-white px-3 py-2 rounded-md text-sm font-medium hover:bg-gold") %>
  </div>
<% end %>
